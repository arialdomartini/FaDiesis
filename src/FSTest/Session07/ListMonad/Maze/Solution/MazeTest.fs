module FSTest.Session07.ListMonad.Maze.Solution.MazeTest

open Maze

open Xunit
open Swensen.Unquote

(*
7 ■■■■■■▫■
6 ■▫▫▫■■▫■
5 ■▫■■■■▫■
4 ■▫■■■▫▫■　
3 ■▫▫▫▫▫■■
2 ■■■■▫■■■
1 ■▫▫▫▫■■■
0 ■■■■■■■■
  01234567
*)

[<Fact>]
let ``find the exit!`` () =

    let walls = set [

        (0,7); (1,7); (2,7); (3,7); (4,7); (5,7);        (7,7);
        (0,6);                      (4,6); (5,6);        (7,6);
        (0,5);        (2,5); (3,5); (4,5); (5,5);        (7,5);
        (0,4);        (2,4); (3,4); (4,4);               (7,4);
        (0,3);                                    (6,3); (7,3);
        (0,2); (1,2); (2,2); (3,2);        (5,2); (6,2); (7,2);
        (0,1);                              (5,1); (6,1); (7,1);
        (0,0); (1,0); (2,0); (3,0); (4,0); (5,0); (6,0); (7,0);
    ]


    let paths = findAllPaths (7, 7) (3,6) walls

    test <@ paths |> List.length = 1 @>

(*
17 ■■■■■■■■■■■■■■■■■■
16 ■■■■☆■■■■■■■■■■■■■
15 ■▫▫▫▫▫▫▫▫▫▫▫▫■■■▫■
14 ■■■■▫■■■■■■■▫■■■▫■
13 ■■■■▫■■■■▫▫▫▫■■■▫■
12 ■■■■▫▫▫▫▫■■■▫■■■▫■
11 ■■■■■■■■▫■■■▫■■■▫■
10 ■■▫▫▫▫■■▫■■■▫■■■▫■
09 ■■▫■■■■■■■■■▫■■■▫■
08 ■■▫■■■▫▫▫▫■■▫▫▫▫▫■
07 ■▫▫▫▫▫▫■■▫■■■■■▫■■
06 ■▫■■■■■■■▫■■■■■▫■■
05 ■▫■■▫▫▫▫▫▫▫▫▫▫▫▫▫■
04 ■▫■■■■■■■■■■■■■■■■
03 ■▫▫▫▫▫▫▫▫▫▫▫▫■■■▫■
02 ■■■■■■■■■▫■■▫■■■▫■
01 ■▫▫▫▫▫▫▫▫▫■■▫▫▫▫▫■
00 ■▫■■■■■■■■■■■■■■■■

*)
let walls () = set [
        (0,17); (1,17); (2,17); (3,17); (4,17); (5,17); (6,17); (7,17); (8,17); (9,17); (10,17); (11,17); (12,17); (13,17); (14,17); (15,17); (16,17); (17,17);
        (0,16); (1,16); (2,16); (3,16);         (5,16); (6,16); (7,16); (8,16); (9,16); (10,16); (11,16); (12,16); (13,16); (14,16); (15,16); (16,16); (17,16);
        (0,15);                                                                                                    (13,15); (14,15); (15,15);          (17,15);
        (0,14); (1,14); (2,14); (3,14);         (5,14); (6,14); (7,14); (8,14); (9,14); (10,14); (11,14);          (13,14); (14,14); (15,14);          (17,14);
        (0,13); (1,13); (2,13); (3,13);         (5,13); (6,13); (7,13); (8,13);                                    (13,13); (14,13); (15,13);          (17,13);
        (0,12); (1,12); (2,12); (3,12);                                         (9,12); (10,12); (11,12);          (13,12); (14,12); (15,12);          (17,12);
        (0,11); (1,11); (2,11); (3,11); (4,11); (5,11); (6,11); (7,11);         (9,11); (10,11); (11,11);          (13,11); (14,11); (15,11);          (17,11);
        (0,10); (1,10);                                 (6,10); (7,10);         (9,10); (10,10); (11,10);          (13,10); (14,10); (15,10);          (17,10);
        (0,9);  (1,9);          (3,9);  (4,9);  (5,9);  (6,9);  (7,9);  (8,9);  (9,9);  (10,9);  (11,9);           (13,9);  (14,9);  (15,9);           (17,9);
        (0,8);  (1,8);          (3,8);  (4,8);  (5,8);                                  (10,8);  (11,8);                                               (17,8);
        (0,7);                                                  (7,7);  (8,7);          (10,7);  (11,7);  (12,7);  (13,7);  (14,7);           (16,7);  (17,7);
        (0,6);          (2,6);  (3,6);  (4,6);  (5,6);  (6,6);  (7,6);  (8,6);          (10,6);  (11,6);  (12,6);  (13,6);  (14,6);           (16,6);  (17,6);
        (0,5);          (2,5);  (3,5);                                                                                                                 (17,5);
        (0,4);          (2,4);  (3,4);  (4,4);  (5,4);  (6,4);  (7,4);  (8,4);  (9,4);  (10,4);  (11,4);  (12,4);  (13,4);  (14,4);  (15,4);  (16,4);  (17,4);
        (0,3);                                                                                                     (13,3);  (14,3);  (15,3);           (17,3);
        (0,2);  (1,2);  (2,2);  (3,2);  (4,2);  (5,2);  (6,2);  (7,2);  (8,2);          (10,2);  (11,2);           (13,2);  (14,2);  (15,2);           (17,2);
        (0,1);                                                                          (10,1);  (11,1);                                               (17,1);
        (0,0);          (2,0);  (3,0);  (4,0);  (5,0);  (6,0);  (7,0);  (8,0);  (9,0);  (10,0);  (11,0);  (12,0);  (13,0);  (14,0);  (15,0);  (16,0);  (17,0);
    ]



[<Fact>]
let ``find the exit, large maze`` () =

    let exit: Direction list =
        [ Down
          Right; Right; Right; Right; Right; Right; Right; Right
          Down; Down; Down; Down; Down; Down; Down
          Right; Right; Right
          Down; Down; Down
          Left; Left; Left; Left; Left; Left
          Up; Up; Up
          Left; Left; Left
          Down
          Left; Left; Left; Left; Left
          Down; Down; Down; Down
          Right; Right; Right; Right; Right; Right; Right; Right
          Down; Down
          Left; Left; Left; Left; Left; Left; Left; Left
          Down]

    let paths = findAllPaths (18, 18) (4,16) (walls ())

    test <@ paths |> List.exactlyOne = exit @>


[<Fact>]
let ``find the exit, large maze, instructions`` () =

    let exit: string list =
        [ "1 Down"
          "8 Right"
          "7 Down"
          "3 Right"
          "3 Down"
          "6 Left"
          "3 Up"
          "3 Left"
          "1 Down"
          "5 Left"
          "4 Down"
          "8 Right"
          "2 Down"
          "8 Left"
          "1 Down" ]

    let paths = findAllPaths (18, 18) (4,16) (walls ())

    let instructions = paths |> List.exactlyOne |> toInstructions
    test <@ instructions = exit @>


(*
17 ■■■■■■■■■■■■■■■■■■
16 ■■■■☆■■■■■■■■■■■■■
15 ■▫▫▫▫▫▫▫▫▫▫▫▫■■■▫■
14 ■■■■▫■■■■■■■▫■■■▫■
13 ■■■■▫■■■■▫▫▫▫■■■▫■
12 ■■■■▫▫▫▫▫■■■▫■■■▫▫
11 ■■■■■■■■▫■■■▫■■■▫■
10 ■■▫▫▫▫■■▫■■■▫■■■▫■
09 ■■▫■■■■■■■■■▫■■■▫■
08 ■■▫■■■▫▫▫▫■■▫▫▫▫▫■
07 ■▫▫▫▫▫▫■■▫■■■■■▫■■
06 ■▫■■■■■■■▫■■■■■▫■■
05 ■▫■■▫▫▫▫▫▫▫▫▫▫▫▫▫■
04 ■▫■■■■■■■■■■■■■■■■
03 ■▫▫▫▫▫▫▫▫▫▫▫▫■■■▫■
02 ■■■■■■■■■▫■■▫■■■▫■
01 ■▫▫▫▫▫▫▫▫▫■■▫▫▫▫▫■
00 ■▫■■■■■■■■■■■■■■■■

*)


[<Fact>]
let ``find the shortest exit, large maze, instructions`` () =

    let exit =
        [ "1 Down"
          "8 Right"
          "7 Down"
          "4 Right"
          "4 Up"
          "1 Right"]

    let walls =
        walls ()
        |> Set.remove (17,12)

    let paths = findAllPaths (18, 18) (4,16) walls

    let instructions =
        paths
        |> List.sortBy _.Length
        |> List.head
        |> toInstructions

    test <@ instructions = exit @>
